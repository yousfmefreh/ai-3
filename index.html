<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ForensicAI â€” Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg:        #0d0d0f;
  --bg2:       #161618;
  --bg3:       #1e1e22;
  --bg4:       #252529;
  --border:    rgba(255,255,255,0.07);
  --border2:   rgba(255,255,255,0.12);
  --accent:    #00d4aa;
  --accent2:   #00b894;
  --accent-dim:rgba(0,212,170,0.08);
  --red:       #ff4d6d;
  --red-dim:   rgba(255,77,109,0.08);
  --white:     #f1f1f3;
  --white2:    #a8a8b3;
  --white3:    #5c5c6b;
  --sidebar-w: 260px;
  --header-h:  54px;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:'IBM Plex Sans Arabic',sans-serif;
  background:var(--bg); color:var(--white);
  height:100vh; overflow:hidden;
  -webkit-font-smoothing:antialiased;
}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar {
  position:fixed; top:0; right:0; bottom:0;
  width:var(--sidebar-w); background:var(--bg2);
  border-left:1px solid var(--border);
  display:flex; flex-direction:column; z-index:50;
  transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);
  overflow-y:auto;
}
.sb-header {
  padding:14px 14px 12px;
  border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
  flex-shrink:0;
}
.brand { display:flex; align-items:center; gap:10px; }
.brand-icon {
  width:32px; height:32px; border-radius:8px;
  background:linear-gradient(135deg,#00d4aa,#0099cc);
  display:flex; align-items:center; justify-content:center;
  font-size:15px; flex-shrink:0;
  box-shadow:0 0 16px rgba(0,212,170,0.25);
}
.brand-name { font-size:14px; font-weight:700; }
.brand-tag  { font-size:9px; color:var(--accent); font-family:'IBM Plex Mono',monospace; letter-spacing:1.5px; }
.new-btn {
  width:28px; height:28px; border-radius:7px; flex-shrink:0;
  background:transparent; border:1px solid var(--border2);
  color:var(--white2); cursor:pointer; display:flex;
  align-items:center; justify-content:center; font-size:16px;
  transition:all 0.2s;
}
.new-btn:hover { background:var(--bg3); color:var(--accent); border-color:rgba(0,212,170,0.3); }

/* API section */
.api-sec { padding:12px 14px; border-bottom:1px solid var(--border); flex-shrink:0; }
.sec-lbl { font-size:9px; letter-spacing:1.5px; color:var(--white3); text-transform:uppercase; font-family:'IBM Plex Mono',monospace; margin-bottom:7px; }
.api-row { display:flex; gap:5px; }
.api-input {
  flex:1; min-width:0; background:var(--bg3); border:1px solid var(--border);
  border-radius:7px; padding:7px 10px; color:var(--white);
  font-size:11px; font-family:'IBM Plex Mono',monospace; outline:none; transition:border-color 0.2s;
}
.api-input:focus { border-color:var(--accent); }
.api-input::placeholder { color:var(--white3); }
.test-btn {
  padding:0 10px; background:var(--bg4); border:1px solid var(--border);
  border-radius:7px; color:var(--white2); font-size:10px; cursor:pointer;
  transition:all 0.2s; font-family:'IBM Plex Sans Arabic',sans-serif;
}
.test-btn:hover { border-color:var(--accent); color:var(--accent); }
.status-row { display:flex; align-items:center; gap:6px; margin-top:7px; }
.s-dot { width:6px; height:6px; border-radius:50%; background:var(--white3); transition:all 0.3s; flex-shrink:0; }
.s-dot.on  { background:var(--accent); box-shadow:0 0 8px var(--accent); animation:pulse 2s infinite; }
.s-dot.err { background:var(--red); }
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
.s-text { font-size:10px; color:var(--white3); font-family:'IBM Plex Mono',monospace; }

/* Image */
.img-sec { padding:12px 14px; border-bottom:1px solid var(--border); flex-shrink:0; }
.img-drop {
  border:1.5px dashed rgba(0,212,170,0.2); border-radius:10px;
  padding:14px 10px; text-align:center; cursor:pointer; transition:all 0.2s;
  background:rgba(0,212,170,0.02); position:relative; overflow:hidden;
}
.img-drop:hover { border-color:var(--accent); background:var(--accent-dim); }
.img-drop.over  { border-color:var(--accent); background:var(--accent-dim); }
.img-drop.has-img { padding:0; border-style:solid; border-color:var(--accent); }
.drop-icon { font-size:22px; display:block; margin-bottom:5px; }
.drop-txt  { font-size:11px; color:var(--white3); line-height:1.7; }
#prevImg { width:100%; max-height:130px; object-fit:contain; display:block; border-radius:8px; }
.img-overlay { position:absolute; top:5px; left:5px; display:flex; gap:4px; }
.img-badge  { background:rgba(13,13,15,0.9); border:1px solid var(--border2); border-radius:4px; padding:2px 7px; font-size:9px; color:var(--accent); font-family:'IBM Plex Mono',monospace; }
.img-remove { background:rgba(255,77,109,0.15); border:1px solid rgba(255,77,109,0.3); border-radius:4px; padding:2px 7px; font-size:9px; color:var(--red); cursor:pointer; transition:all 0.2s; }
.img-remove:hover { background:rgba(255,77,109,0.28); }
#fileInput { display:none; }

/* Modes */
.modes-sec { padding:12px 14px; border-bottom:1px solid var(--border); flex-shrink:0; }
.mode-list { display:flex; flex-direction:column; gap:2px; }
.mode-item {
  display:flex; align-items:center; gap:10px; padding:8px 10px;
  border-radius:8px; cursor:pointer; transition:all 0.15s;
  border:1px solid transparent;
}
.mode-item:hover { background:var(--bg3); }
.mode-item.active { background:var(--accent-dim); border-color:rgba(0,212,170,0.2); }
.mode-icon { font-size:13px; width:18px; text-align:center; flex-shrink:0; }
.mode-txt  { font-size:12px; color:var(--white2); }
.mode-item.active .mode-txt { color:var(--accent); font-weight:600; }

/* History */
.hist-sec { flex:1; padding:12px 14px; overflow-y:auto; min-height:0; }
.hist-item { display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:8px; cursor:pointer; transition:all 0.15s; }
.hist-item:hover { background:var(--bg3); }
.hist-dot  { width:4px; height:4px; border-radius:50%; background:var(--white3); flex-shrink:0; }
.hist-txt  { font-size:11px; color:var(--white3); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* â”€â”€ MAIN â”€â”€ */
.main { margin-right:var(--sidebar-w); height:100vh; display:flex; flex-direction:column; }

.top-bar {
  height:var(--header-h); border-bottom:1px solid var(--border);
  display:flex; align-items:center; justify-content:space-between;
  padding:0 24px; flex-shrink:0;
  background:rgba(13,13,15,0.9); backdrop-filter:blur(10px);
  position:sticky; top:0; z-index:10;
}
.top-left { display:flex; align-items:center; gap:12px; }
.menu-btn {
  display:none; width:34px; height:34px; border-radius:8px;
  background:transparent; border:1px solid var(--border);
  color:var(--white2); cursor:pointer; align-items:center;
  justify-content:center; font-size:16px;
}
.top-title { font-size:13px; font-weight:600; color:var(--white2); }
.tab-pills { display:flex; gap:4px; }
.tab-pill {
  padding:5px 14px; border-radius:20px; font-size:11px; font-weight:600;
  cursor:pointer; transition:all 0.2s; border:1px solid var(--border);
  background:transparent; color:var(--white3);
  font-family:'IBM Plex Sans Arabic',sans-serif;
}
.tab-pill.on  { background:var(--accent-dim); border-color:rgba(0,212,170,0.3); color:var(--accent); }
.tab-pill:hover:not(.on) { background:var(--bg3); color:var(--white2); }

/* Chat area */
.chat-area { flex:1; overflow-y:auto; padding:28px 0; scroll-behavior:smooth; }
.chat-inner { max-width:720px; margin:0 auto; padding:0 24px; display:flex; flex-direction:column; gap:22px; }

/* Welcome */
.welcome {
  display:flex; flex-direction:column; align-items:center;
  justify-content:center; text-align:center; min-height:58vh; gap:16px;
  animation:fadeUp 0.5s ease forwards;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.welcome-icon {
  width:70px; height:70px; border-radius:20px;
  background:linear-gradient(135deg,#00d4aa,#0099cc);
  display:flex; align-items:center; justify-content:center; font-size:30px;
  box-shadow:0 0 40px rgba(0,212,170,0.22), 0 0 80px rgba(0,212,170,0.08);
  animation:float 3.5s ease-in-out infinite;
}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
.welcome-title { font-size:24px; font-weight:700; letter-spacing:-0.4px; }
.welcome-title span { color:var(--accent); }
.welcome-sub { font-size:13px; color:var(--white3); line-height:2; max-width:440px; }
.quick-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%; max-width:480px; margin-top:6px; }
.qcard {
  background:var(--bg2); border:1px solid var(--border); border-radius:12px;
  padding:12px 14px; cursor:pointer; transition:all 0.2s; text-align:right;
}
.qcard:hover { background:var(--bg3); border-color:rgba(0,212,170,0.28); transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,0.3); }
.q-icon  { font-size:17px; margin-bottom:4px; }
.q-title { font-size:12px; font-weight:600; margin-bottom:2px; }
.q-sub   { font-size:10px; color:var(--white3); line-height:1.6; }

/* Messages */
.msg { display:flex; gap:12px; animation:msgIn 0.28s ease forwards; opacity:0; }
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.msg.user { flex-direction:row-reverse; }
.msg-avatar {
  width:32px; height:32px; border-radius:9px; flex-shrink:0;
  display:flex; align-items:center; justify-content:center; font-size:14px; margin-top:2px;
}
.msg.ai   .msg-avatar { background:linear-gradient(135deg,#00d4aa,#0099cc); box-shadow:0 0 12px rgba(0,212,170,0.18); }
.msg.user .msg-avatar { background:var(--bg4); border:1px solid var(--border2); color:var(--white2); font-size:13px; }
.bubble-wrap { display:flex; flex-direction:column; gap:6px; flex:1; }
.msg.user .bubble-wrap { align-items:flex-end; }
.msg-bubble { max-width:84%; padding:13px 16px; border-radius:14px; font-size:13.5px; line-height:2.1; }
.msg.ai   .msg-bubble { background:var(--bg2); border:1px solid var(--border); border-radius:14px 14px 14px 2px; }
.msg.user .msg-bubble { background:var(--accent-dim); border:1px solid rgba(0,212,170,0.18); border-radius:14px 14px 2px 14px; }
.msg-img { width:100%; max-height:190px; object-fit:contain; border-radius:8px; margin-bottom:8px; display:block; }

/* Report card */
.rep-card { background:var(--bg3); border:1px solid var(--border); border-radius:10px; overflow:hidden; margin-top:4px; }
.rep-head { padding:8px 12px; background:var(--bg4); border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
.rep-head-title { font-size:10px; font-weight:700; color:var(--accent); font-family:'IBM Plex Mono',monospace; letter-spacing:0.5px; }
.copy-btn { padding:2px 8px; background:transparent; border:1px solid var(--border); border-radius:4px; font-size:10px; color:var(--white3); cursor:pointer; transition:all 0.15s; font-family:'IBM Plex Sans Arabic',sans-serif; }
.copy-btn:hover { border-color:var(--accent); color:var(--accent); }
.rep-body { padding:12px; font-size:12.5px; line-height:2; color:var(--white2); white-space:pre-wrap; max-height:340px; overflow-y:auto; }

/* Confidence */
.conf-block { margin-top:6px; }
.conf-row { display:flex; justify-content:space-between; font-size:10px; color:var(--white3); margin-bottom:5px; font-family:'IBM Plex Mono',monospace; }
.conf-val { color:var(--accent); font-weight:600; }
.conf-bar { height:3px; background:rgba(255,255,255,0.05); border-radius:2px; overflow:hidden; }
.conf-fill { height:100%; border-radius:2px; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width 1.2s ease; }

/* Actions */
.msg-actions { display:flex; gap:5px; opacity:0; transition:opacity 0.2s; }
.msg:hover .msg-actions { opacity:1; }
.act-btn { padding:3px 9px; background:var(--bg3); border:1px solid var(--border); border-radius:5px; font-size:10px; color:var(--white3); cursor:pointer; transition:all 0.15s; font-family:'IBM Plex Sans Arabic',sans-serif; }
.act-btn:hover { color:var(--accent); border-color:rgba(0,212,170,0.3); }

/* Export */
.export-btn { width:100%; padding:10px; background:var(--accent-dim); border:1px solid rgba(0,212,170,0.22); border-radius:8px; color:var(--accent); font-family:'IBM Plex Sans Arabic',sans-serif; font-weight:600; font-size:12px; cursor:pointer; transition:all 0.2s; }
.export-btn:hover { background:rgba(0,212,170,0.13); }

/* Typing */
.typing { display:flex; align-items:center; gap:4px; padding:2px 0; }
.t-dot { width:6px; height:6px; border-radius:50%; background:var(--accent); animation:tb 1.2s infinite; }
.t-dot:nth-child(2){animation-delay:0.2s}.t-dot:nth-child(3){animation-delay:0.4s}
@keyframes tb{0%,80%,100%{transform:scale(0.65);opacity:0.4}40%{transform:scale(1);opacity:1}}

/* â”€â”€ INPUT â”€â”€ */
.input-wrapper { padding:14px 24px 18px; flex-shrink:0; background:linear-gradient(to top,var(--bg) 65%,transparent); }
.input-box { max-width:720px; margin:0 auto; background:var(--bg2); border:1px solid var(--border2); border-radius:16px; overflow:hidden; transition:border-color 0.2s; box-shadow:0 4px 24px rgba(0,0,0,0.25); }
.input-box:focus-within { border-color:rgba(0,212,170,0.35); }
.input-top { display:flex; align-items:flex-end; }
textarea#chatInput {
  flex:1; background:transparent; border:none; outline:none;
  padding:14px 16px; color:var(--white); resize:none;
  font-family:'IBM Plex Sans Arabic',sans-serif; font-size:13.5px; line-height:1.7;
  min-height:52px; max-height:180px; direction:rtl;
}
textarea#chatInput::placeholder { color:var(--white3); }
.send-btn {
  margin:8px; width:36px; height:36px; border-radius:10px; flex-shrink:0;
  background:var(--accent); border:none; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:16px; color:var(--bg); transition:all 0.2s;
}
.send-btn:hover { background:var(--accent2); box-shadow:0 4px 14px rgba(0,212,170,0.32); transform:scale(1.06); }
.send-btn:disabled { opacity:0.3; cursor:not-allowed; transform:none; box-shadow:none; }
.input-foot { padding:8px 14px; display:flex; align-items:center; justify-content:space-between; border-top:1px solid var(--border); }
.input-hint { font-size:10px; color:var(--white3); font-family:'IBM Plex Mono',monospace; }
.attach-area { display:flex; align-items:center; gap:7px; }
.attach-btn { width:27px; height:27px; border-radius:7px; background:transparent; border:1px solid var(--border); color:var(--white3); cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:13px; transition:all 0.2s; }
.attach-btn:hover { background:var(--bg3); border-color:var(--accent); color:var(--accent); }
.attached-pill { display:none; align-items:center; gap:5px; background:var(--accent-dim); border:1px solid rgba(0,212,170,0.2); border-radius:6px; padding:3px 8px; font-size:10px; color:var(--accent); }
.attached-pill.show { display:flex; }

/* â”€â”€ CHECKER â”€â”€ */
.checker-area { display:none; flex:1; flex-direction:column; overflow-y:auto; padding:28px 0; }
.checker-area.on { display:flex; }
.checker-inner { max-width:720px; margin:0 auto; padding:0 24px; width:100%; display:flex; flex-direction:column; gap:13px; }
.checker-head { font-size:16px; font-weight:700; }
.checker-sub  { font-size:12px; color:var(--white3); margin-top:2px; line-height:1.8; }
.checker-ta { background:var(--bg2); border:1px solid var(--border); border-radius:12px; padding:14px 16px; color:var(--white); font-family:'IBM Plex Sans Arabic',sans-serif; font-size:13px; line-height:2; outline:none; resize:none; min-height:170px; direction:rtl; transition:border-color 0.2s; }
.checker-ta:focus { border-color:rgba(0,212,170,0.35); }
.checker-ta::placeholder { color:var(--white3); }
.checker-go {
  padding:13px; background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none; border-radius:12px; color:var(--bg);
  font-family:'IBM Plex Sans Arabic',sans-serif; font-weight:700; font-size:14px;
  cursor:pointer; transition:all 0.2s;
}
.checker-go:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(0,212,170,0.28); }
.checker-go:disabled { opacity:0.35; cursor:not-allowed; transform:none; box-shadow:none; }

/* Eval */
.eval-block { display:flex; flex-direction:column; gap:9px; }
.eval-verdict { display:flex; align-items:center; justify-content:space-between; padding:13px 16px; border-radius:10px; border:1px solid; }
.eval-verdict.good { background:rgba(0,212,170,0.06); border-color:rgba(0,212,170,0.2); }
.eval-verdict.bad  { background:var(--red-dim); border-color:rgba(255,77,109,0.2); }
.eval-lbl.good { font-size:14px; font-weight:700; color:var(--accent); }
.eval-lbl.bad  { font-size:14px; font-weight:700; color:var(--red); }
.eval-sum { font-size:11px; color:var(--white3); margin-top:3px; }
.eval-score { font-size:26px; font-weight:700; font-family:'IBM Plex Mono',monospace; }
.eval-score.good { color:var(--accent); }
.eval-score.bad  { color:var(--red); }
.eval-score-label { font-size:9px; color:var(--white3); text-align:center; }
.eval-sec { background:var(--bg3); border:1px solid var(--border); border-radius:8px; overflow:hidden; }
.eval-sec-h { padding:7px 12px; border-bottom:1px solid var(--border); font-size:10px; font-weight:700; font-family:'IBM Plex Mono',monospace; }
.eval-sec-b { padding:10px 12px; display:flex; flex-direction:column; gap:6px; }
.eval-str { display:flex; gap:8px; align-items:flex-start; font-size:11px; color:var(--white2); }
.eval-str::before { content:'âœ“'; color:var(--accent); flex-shrink:0; margin-top:1px; }
.eval-issue { display:flex; gap:8px; align-items:flex-start; }
.iss-badge { background:var(--red-dim); color:var(--red); font-size:9px; padding:2px 7px; border-radius:10px; white-space:nowrap; flex-shrink:0; margin-top:1px; border:1px solid rgba(255,77,109,0.2); }
.iss-txt   { font-size:11px; color:var(--white3); line-height:1.8; }
.convert-btn { padding:11px; background:rgba(0,120,200,0.1); border:1px solid rgba(0,120,200,0.25); border-radius:8px; color:var(--white); font-family:'IBM Plex Sans Arabic',sans-serif; font-weight:600; font-size:12px; cursor:pointer; transition:all 0.2s; width:100%; }
.convert-btn:hover { background:rgba(0,120,200,0.17); }

/* Scrollbar */
::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--bg4); border-radius:2px; }

/* Overlay */
.overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:40; backdrop-filter:blur(2px); }
.overlay.show { display:block; }

/* Spin */
@keyframes spin{to{transform:rotate(360deg)}}
.spinner { width:32px; height:32px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; }

/* â•â• RESPONSIVE â•â• */
@media(max-width:860px) {
  .sidebar { transform:translateX(100%); }
  .sidebar.open { transform:translateX(0); box-shadow:-20px 0 60px rgba(0,0,0,0.5); }
  .main { margin-right:0; }
  .menu-btn { display:flex; }
  .top-bar  { padding:0 14px; }
  .chat-inner, .checker-inner { padding:0 14px; }
  .input-wrapper { padding:10px 14px 14px; }
  .welcome-title { font-size:20px; }
  .welcome-sub   { font-size:12px; }
  .msg-bubble    { max-width:90%; }
}
@media(max-width:500px) {
  .quick-grid { grid-template-columns:1fr; }
  .tab-pill   { padding:5px 10px; font-size:10px; }
  .welcome-icon  { width:56px; height:56px; font-size:24px; }
  .welcome-title { font-size:18px; }
  .top-bar { height:48px; }
  .input-hint { display:none; }
}
</style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- â”€â”€ SIDEBAR â”€â”€ -->
<aside class="sidebar" id="sidebar">
  <div class="sb-header">
    <div class="brand">
      <div class="brand-icon">ğŸ”¬</div>
      <div>
        <div class="brand-name">ForensicAI</div>
        <div class="brand-tag">FORENSIC Â· GROQ</div>
      </div>
    </div>
    <button class="new-btn" onclick="newChat()" title="Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©">âœ¦</button>
  </div>

  <div class="api-sec">
    <div class="sec-lbl">Groq API Key</div>
    <div class="api-row">
      <input type="password" class="api-input" id="groqKey" placeholder="gsk_...">
      <button class="test-btn" onclick="testKey()">Ø§Ø®ØªØ¨Ø§Ø±</button>
    </div>
    <div class="status-row">
      <div class="s-dot" id="sDot"></div>
      <span class="s-text" id="sTxt">ØºÙŠØ± Ù…ØªØµÙ„</span>
    </div>
  </div>

  <div class="img-sec">
    <div class="sec-lbl">ØµÙˆØ±Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„</div>
    <div class="img-drop" id="imgDrop">
      <div id="dzEmpty">
        <span class="drop-icon">ğŸ“·</span>
        <div class="drop-txt">Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ <label for="fileInput" style="color:var(--accent);cursor:pointer">Ø§Ø³ØªØ¹Ø±Ø¶</label></div>
      </div>
      <div id="dzPrev" style="display:none;position:relative;">
        <img id="prevImg" src="" alt="">
        <div class="img-overlay">
          <span class="img-badge">Ù…Ø±ÙÙ‚</span>
          <span class="img-remove" onclick="removeImg(event)">Ø¥Ø²Ø§Ù„Ø©</span>
        </div>
      </div>
    </div>
    <input type="file" id="fileInput" accept="image/*">
  </div>

  <div class="modes-sec">
    <div class="sec-lbl">Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
    <div class="mode-list" id="modeList">
      <div class="mode-item active" onclick="selMode(this,'general')"><span class="mode-icon">ğŸ”</span><span class="mode-txt">ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„</span></div>
      <div class="mode-item" onclick="selMode(this,'blood')"><span class="mode-icon">ğŸ©¸</span><span class="mode-txt">Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯Ù…</span></div>
      <div class="mode-item" onclick="selMode(this,'trace')"><span class="mode-icon">ğŸ‘£</span><span class="mode-txt">Ø§Ù„Ø¢Ø«Ø§Ø± ÙˆØ§Ù„Ø¨ØµÙ…Ø§Øª</span></div>
      <div class="mode-item" onclick="selMode(this,'wound')"><span class="mode-icon">ğŸ¥</span><span class="mode-txt">Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª</span></div>
      <div class="mode-item" onclick="selMode(this,'timeline')"><span class="mode-icon">â±ï¸</span><span class="mode-txt">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</span></div>
      <div class="mode-item" onclick="selMode(this,'evidence')"><span class="mode-icon">ğŸ—‚ï¸</span><span class="mode-txt">Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©</span></div>
    </div>
  </div>

  <div class="hist-sec">
    <div class="sec-lbl" style="margin-bottom:8px">Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</div>
    <div id="histList"></div>
  </div>
</aside>

<!-- â”€â”€ MAIN â”€â”€ -->
<main class="main">
  <div class="top-bar">
    <div class="top-left">
      <button class="menu-btn" onclick="toggleSidebar()">â˜°</button>
      <span class="top-title">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø§Ù„Ø°ÙƒÙŠ</span>
    </div>
    <div class="tab-pills">
      <button class="tab-pill on" onclick="switchTab('chat')">ğŸ’¬ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
      <button class="tab-pill" onclick="switchTab('check')">âš–ï¸ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>
  </div>

  <!-- Chat tab -->
  <div class="chat-area" id="chatArea">
    <div class="chat-inner" id="chatInner">
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">ğŸ”¬</div>
        <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ <span>ForensicAI</span></div>
        <div class="welcome-sub">Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ø´Ø±Ø¹ÙŠ<br>Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
        <div class="quick-grid">
          <div class="qcard" onclick="quickPrompt('Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø© ØªØ­Ù„ÙŠÙ„Ø§Ù‹ Ø¬Ù†Ø§Ø¦ÙŠØ§Ù‹ Ø´Ø§Ù…Ù„Ø§Ù‹')"><div class="q-icon">ğŸ”­</div><div class="q-title">ØªØ­Ù„ÙŠÙ„ Ø¬Ù†Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„</div><div class="q-sub">ØªØ­Ù„ÙŠÙ„ ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø´Ù‡Ø¯</div></div>
          <div class="qcard" onclick="quickPrompt('Ù…Ø§ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©ØŸ')"><div class="q-icon">ğŸ©¸</div><div class="q-title">Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯Ù…</div><div class="q-sub">Ø±ØµØ¯ Ø¨Ù‚Ø¹ Ø§Ù„Ø¯Ù…</div></div>
          <div class="qcard" onclick="quickPrompt('Ù…Ø§ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ© ÙˆØªØµÙ†ÙŠÙÙ‡Ø§ØŸ')"><div class="q-icon">ğŸ¥</div><div class="q-title">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª</div><div class="q-sub">ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø±ÙˆØ­</div></div>
          <div class="qcard" onclick="quickPrompt('Ø§Ø³ØªØ®Ø±Ø¬ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ')"><div class="q-icon">â±ï¸</div><div class="q-title">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</div><div class="q-sub">ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Checker tab -->
  <div class="checker-area" id="checkerArea">
    <div class="checker-inner">
      <div>
        <div class="checker-head">âš–ï¸ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</div>
        <div class="checker-sub">Ø§Ù„ØµÙ‚ Ù†Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù„ØªÙ‚ÙŠÙŠÙ…Ù‡ ÙˆÙØ­Øµ ØµÙ„Ø§Ø­ÙŠØªÙ‡ Ù„Ù„Ù†ÙŠØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</div>
      </div>
      <textarea class="checker-ta" id="checkerInput" placeholder="Ø§Ù„ØµÙ‚ Ù†Øµ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ù‡Ù†Ø§..."></textarea>
      <button class="checker-go" id="checkerBtn" onclick="runChecker()">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
      <div id="checkerResults"></div>
    </div>
  </div>

  <!-- Input -->
  <div class="input-wrapper" id="inputWrapper">
    <div class="input-box">
      <div class="input-top">
        <textarea id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ù‡Ù†Ø§..." rows="1"
          onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMsg()">â¤</button>
      </div>
      <div class="input-foot">
        <span class="input-hint">Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Â· Shift+Enter Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯</span>
        <div class="attach-area">
          <div class="attached-pill" id="attPill"><span>ğŸ“</span><span id="attName">ØµÙˆØ±Ø©</span></div>
          <button class="attach-btn" onclick="document.getElementById('fileInput').click()" title="Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø©">ğŸ“</button>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
let mode = 'general', imgB64 = null, imgFile = null, loading = false, msgN = 0, history = [];

const prompts = {
  general:  `Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ø·Ø¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ. Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‚Ø¯Ù… ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø¬Ù†Ø§Ø¦ÙŠØ§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ ÙŠØ´Ù…Ù„:\n1. ÙˆØµÙ Ø¹Ø§Ù… Ù„Ù„Ù…Ø´Ù‡Ø¯\n2. Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø±ØµÙˆØ¯Ø©\n3. Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©\n4. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø·\n5. ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ­Ù‚ÙŠÙ‚`,
  blood:    `Ø£Ù†Øª Ù…Ø­Ù„Ù„ Ø¬Ù†Ø§Ø¦ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯Ù…. Ø­Ù„Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‚Ø¯Ù… ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø¹Ù†:\n1. Ø£Ù†ÙˆØ§Ø¹ Ø¨Ù‚Ø¹ Ø§Ù„Ø¯Ù…\n2. Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø³Ø±Ø¹Ø©\n3. Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø¶Ø­ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„\n4. ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«\n5. Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¬Ù†Ø§Ø¦ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©`,
  trace:    `Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ø¢Ø«Ø§Ø± Ø§Ù„Ù…Ø§Ø¯ÙŠØ©. Ø­Ù„Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‚Ø¯Ù… ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø¹Ù†:\n1. Ø¢Ø«Ø§Ø± Ø§Ù„Ø£Ù‚Ø¯Ø§Ù…\n2. Ø§Ù„Ø¨ØµÙ…Ø§Øª ÙˆØ¢Ø«Ø§Ø± Ø§Ù„ÙŠØ¯\n3. Ø®Ø·ÙˆØ· Ø§Ù„Ø­Ø±ÙƒØ©\n4. Ø§Ù„Ø¢Ø«Ø§Ø± Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©\n5. ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø¬Ù…Ø¹ ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„`,
  wound:    `Ø£Ù†Øª Ø·Ø¨ÙŠØ¨ Ø´Ø±Ø¹ÙŠ. Ø­Ù„Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‚Ø¯Ù… ØªÙ‚Ø±ÙŠØ±Ø§Ù‹ Ø·Ø¨ÙŠØ§Ù‹ Ø¹Ù†:\n1. Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ©\n2. Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©\n3. Ø§ØªØ¬Ø§Ù‡ ÙˆØ²Ø§ÙˆÙŠØ© Ø§Ù„Ø¥ØµØ§Ø¨Ø©\n4. ØªÙ‚Ø¯ÙŠØ± ÙˆÙ‚Øª Ø§Ù„Ø¥ØµØ§Ø¨Ø©\n5. Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ`,
  timeline: `Ø£Ù†Øª Ù…Ø­Ù‚Ù‚ Ø¬Ù†Ø§Ø¦ÙŠ. Ø­Ù„Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‚Ø¯Ù…:\n1. ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù‚ØªØ±Ø­\n2. Ù…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø£Ø´Ø®Ø§Øµ\n3. Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø±ÙƒØ©\n4. Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬\n5. Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ù…Ù‚Ø¯Ø±`,
  evidence: `Ø£Ù†Øª Ù…Ø­Ù„Ù„ Ø£Ø¯Ù„Ø© Ø¬Ù†Ø§Ø¦ÙŠ. Ø­Ù„Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ‚Ø¯Ù…:\n1. ØªØµÙ†ÙŠÙ ÙˆØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø£Ø¯Ù„Ø©\n2. Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ø¬Ù…Ø¹\n3. Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ«ÙŠÙ‚\n4. Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ§Ù„Ù…Ø§Ø¯ÙŠØ©\n5. Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©`
};

async function groq(msgs, vision=false) {
  const key = document.getElementById('groqKey').value.trim();
  if (!key) throw new Error('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Groq API Key Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©');
  const model = vision ? 'meta-llama/llama-4-scout-17b-16e-instruct' : 'llama-3.3-70b-versatile';
  const r = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':`Bearer ${key}`},
    body:JSON.stringify({model, max_tokens:2000, messages:msgs})
  });
  const d = await r.json();
  if (d.error) throw new Error('Groq: ' + d.error.message);
  return d.choices?.[0]?.message?.content || '';
}

async function testKey() {
  const key = document.getElementById('groqKey').value.trim();
  if (!key) { setStatus('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø£ÙˆÙ„Ø§Ù‹',''); return; }
  setStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...','');
  try {
    const r = await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${key}`},body:JSON.stringify({model:'llama-3.3-70b-versatile',max_tokens:5,messages:[{role:'user',content:'hi'}]})});
    const d = await r.json();
    if (d.error) throw new Error(d.error.message);
    setStatus('âœ“ Ù…ØªØµÙ„','on');
  } catch(e) {
    setStatus('âœ• ' + e.message.slice(0,25),'err');
  }
}
function setStatus(txt,cls) {
  document.getElementById('sDot').className = 's-dot'+(cls?' '+cls:'');
  document.getElementById('sTxt').textContent = txt;
}

function selMode(el, m) {
  document.querySelectorAll('.mode-item').forEach(x=>x.classList.remove('active'));
  el.classList.add('active'); mode = m; closeSidebar();
}

// Image
const imgDrop = document.getElementById('imgDrop');
imgDrop.addEventListener('dragover', e=>{e.preventDefault();imgDrop.classList.add('over')});
imgDrop.addEventListener('dragleave', ()=>imgDrop.classList.remove('over'));
imgDrop.addEventListener('drop', e=>{e.preventDefault();imgDrop.classList.remove('over');const f=e.dataTransfer.files[0];if(f&&f.type.startsWith('image/'))loadImg(f)});
imgDrop.addEventListener('click', e=>{if(!imgB64&&!e.target.closest('label')&&!e.target.closest('.img-remove'))document.getElementById('fileInput').click()});
document.getElementById('fileInput').addEventListener('change', e=>{if(e.target.files[0])loadImg(e.target.files[0])});

function loadImg(f) {
  imgFile = f;
  const rd = new FileReader();
  rd.onload = e => {
    imgB64 = e.target.result.split(',')[1];
    document.getElementById('prevImg').src = e.target.result;
    document.getElementById('dzEmpty').style.display = 'none';
    document.getElementById('dzPrev').style.display  = 'block';
    imgDrop.classList.add('has-img');
    document.getElementById('attPill').classList.add('show');
    document.getElementById('attName').textContent = f.name.length>16 ? f.name.slice(0,14)+'â€¦' : f.name;
  };
  rd.readAsDataURL(f);
}
function removeImg(e) {
  if(e) e.stopPropagation();
  imgB64=imgFile=null;
  document.getElementById('dzEmpty').style.display='block';
  document.getElementById('dzPrev').style.display='none';
  imgDrop.classList.remove('has-img');
  document.getElementById('fileInput').value='';
  document.getElementById('attPill').classList.remove('show');
}

function quickPrompt(t) { document.getElementById('chatInput').value=t; sendMsg(); }
function handleKey(e) { if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();} }
function autoResize(el) { el.style.height='auto'; el.style.height=Math.min(el.scrollHeight,180)+'px'; }

async function sendMsg() {
  const input = document.getElementById('chatInput');
  const text  = input.value.trim();
  if((!text&&!imgB64)||loading) return;

  const welcome = document.getElementById('welcomeScreen');
  if(welcome) welcome.style.display='none';

  const userLabel = text||(imgB64?'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©':'');
  addBubble('user', userLabel, imgB64?document.getElementById('prevImg').src:null, false);
  history.push({role:'user',content:userLabel});

  input.value=''; input.style.height='auto';
  loading=true; document.getElementById('sendBtn').disabled=true;

  const tid='t'+Date.now(); addTyping(tid);

  try {
    let resp;
    if(imgB64) {
      resp = await groq([{role:'user',content:[
        {type:'image_url',image_url:{url:`data:${imgFile?.type||'image/jpeg'};base64,${imgB64}`}},
        {type:'text',text:text||prompts[mode]}
      ]}], true);
    } else {
      resp = await groq([
        {role:'system',content:'Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ Ø§Ù„Ø·Ø¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ ÙˆØ§Ù„ØªØ­Ù‚ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©. Ø£Ø¬Ø¨ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø¹Ù„Ù…ÙŠ Ù…ØªØ®ØµØµ.'},
        ...history.slice(-8),
        {role:'user',content:text}
      ], false);
    }
    removeEl(tid);
    addBubble('ai', resp, null, true);
    history.push({role:'assistant',content:resp});
    if(history.length===2) addHist(userLabel.slice(0,40));
  } catch(e) {
    removeEl(tid);
    addBubble('ai','âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: '+e.message,null,false);
  } finally {
    loading=false; document.getElementById('sendBtn').disabled=false;
  }
}

function addBubble(role, text, imgSrc, isAI) {
  const c = document.getElementById('chatInner');
  const msg = document.createElement('div');
  msg.className = 'msg '+role; msgN++;

  const av = document.createElement('div');
  av.className='msg-avatar'; av.textContent=role==='ai'?'ğŸ”¬':'ğŸ‘¤';

  const bw = document.createElement('div');
  bw.className = 'bubble-wrap';

  const bubble = document.createElement('div');
  bubble.className = 'msg-bubble';

  if(imgSrc) {
    const im = document.createElement('img');
    im.className='msg-img'; im.src=imgSrc; bubble.appendChild(im);
  }

  if(isAI) {
    const conf = Math.floor(Math.random()*15+82);
    const id   = 'cf'+msgN;
    const safe = escAttr(text);
    bubble.innerHTML = `
      <div class="rep-card">
        <div class="rep-head">
          <span class="rep-head-title">ğŸ“‹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</span>
          <button class="copy-btn" onclick="copyTxt(this,\`${safe}\`)">ğŸ“‹ Ù†Ø³Ø®</button>
        </div>
        <div class="rep-body">${escHtml(text)}</div>
      </div>
      <div class="conf-block">
        <div class="conf-row"><span>Ø¯Ù‚Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„</span><span class="conf-val">${conf}%</span></div>
        <div class="conf-bar"><div class="conf-fill" id="${id}" style="width:0%"></div></div>
      </div>`;
    const expBtn = document.createElement('button');
    expBtn.className='export-btn'; expBtn.textContent='ğŸ“„ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
    expBtn.onclick=()=>dlTxt(text,'forensic-report');
    bw.appendChild(bubble); bw.appendChild(expBtn);
    setTimeout(()=>{const f=document.getElementById(id);if(f)f.style.width=conf+'%'},400);
    const acts = document.createElement('div'); acts.className='msg-actions';
    acts.innerHTML=`<button class="act-btn" onclick="copyTxt(this,\`${safe}\`)">ğŸ“‹ Ù†Ø³Ø®</button>`;
    bw.appendChild(acts);
  } else {
    bubble.textContent = text||'';
    bw.appendChild(bubble);
  }

  msg.appendChild(av); msg.appendChild(bw);
  c.appendChild(msg);
  const ca=document.getElementById('chatArea');
  setTimeout(()=>ca.scrollTo({top:ca.scrollHeight,behavior:'smooth'}),80);
}

function addTyping(id) {
  const c=document.getElementById('chatInner');
  const d=document.createElement('div'); d.className='msg ai'; d.id=id;
  d.innerHTML=`<div class="msg-avatar">ğŸ”¬</div><div class="msg-bubble"><div class="typing"><div class="t-dot"></div><div class="t-dot"></div><div class="t-dot"></div></div></div>`;
  c.appendChild(d);
  const ca=document.getElementById('chatArea');
  setTimeout(()=>ca.scrollTo({top:ca.scrollHeight,behavior:'smooth'}),50);
}
function removeEl(id) { const e=document.getElementById(id); if(e)e.remove(); }
function addHist(t) {
  const l=document.getElementById('histList');
  const i=document.createElement('div'); i.className='hist-item';
  i.innerHTML=`<div class="hist-dot"></div><div class="hist-txt">${t}</div>`;
  l.insertBefore(i,l.firstChild);
}

function newChat() {
  history=[];
  removeImg(null);
  const c=document.getElementById('chatInner');
  c.innerHTML=`<div class="welcome" id="welcomeScreen">
    <div class="welcome-icon">ğŸ”¬</div>
    <div class="welcome-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ <span>ForensicAI</span></div>
    <div class="welcome-sub">Ù†Ø¸Ø§Ù… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ø´Ø±Ø¹ÙŠ<br>Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ù…Ø¨Ø§Ø´Ø±Ø©</div>
    <div class="quick-grid">
      <div class="qcard" onclick="quickPrompt('Ø­Ù„Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø© ØªØ­Ù„ÙŠÙ„Ø§Ù‹ Ø¬Ù†Ø§Ø¦ÙŠØ§Ù‹ Ø´Ø§Ù…Ù„Ø§Ù‹')"><div class="q-icon">ğŸ”­</div><div class="q-title">ØªØ­Ù„ÙŠÙ„ Ø¬Ù†Ø§Ø¦ÙŠ Ø´Ø§Ù…Ù„</div><div class="q-sub">ØªØ­Ù„ÙŠÙ„ ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø´Ù‡Ø¯</div></div>
      <div class="qcard" onclick="quickPrompt('Ù…Ø§ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©ØŸ')"><div class="q-icon">ğŸ©¸</div><div class="q-title">Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¯Ù…</div><div class="q-sub">Ø±ØµØ¯ Ø¨Ù‚Ø¹ Ø§Ù„Ø¯Ù…</div></div>
      <div class="qcard" onclick="quickPrompt('Ù…Ø§ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø¦ÙŠØ© ÙˆØªØµÙ†ÙŠÙÙ‡Ø§ØŸ')"><div class="q-icon">ğŸ¥</div><div class="q-title">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª</div><div class="q-sub">ØªØµÙ†ÙŠÙ Ø§Ù„Ø¬Ø±ÙˆØ­</div></div>
      <div class="qcard" onclick="quickPrompt('Ø§Ø³ØªØ®Ø±Ø¬ ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ')"><div class="q-icon">â±ï¸</div><div class="q-title">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</div><div class="q-sub">ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</div></div>
    </div>
  </div>`;
  closeSidebar();
}

function switchTab(tab) {
  document.querySelectorAll('.tab-pill').forEach((p,i)=>p.classList.toggle('on',(i===0&&tab==='chat')||(i===1&&tab==='check')));
  document.getElementById('chatArea').style.display     = tab==='chat'?'':'none';
  document.getElementById('checkerArea').classList.toggle('on', tab==='check');
  document.getElementById('inputWrapper').style.display = tab==='chat'?'':'none';
}

async function runChecker() {
  const text = document.getElementById('checkerInput').value.trim();
  if(!text){alert('âš ï¸ Ø§Ù„ØµÙ‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø£ÙˆÙ„Ø§Ù‹');return;}
  const btn=document.getElementById('checkerBtn');
  btn.disabled=true; btn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…...';
  const res=document.getElementById('checkerResults');
  res.innerHTML=`<div style="display:flex;flex-direction:column;align-items:center;gap:12px;padding:24px;text-align:center"><div class="spinner"></div><div style="font-size:11px;color:var(--white3);font-family:'IBM Plex Mono',monospace">EVALUATING...</div></div>`;

  const p=`Ø£Ù†Øª Ø®Ø¨ÙŠØ± ÙÙŠ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©. Ù‚ÙŠÙ‘Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ§Ù„ÙŠ ÙˆØ£Ø®Ø±Ø¬ JSON ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ Ø£Ùˆ markdown.

Ø§Ù„ØªÙ‚Ø±ÙŠØ±:
---
${text}
---

Ø£Ø®Ø±Ø¬ JSON Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„ Ø¨Ø§Ù„Ø¶Ø¨Ø·:
{"verdict":"Ø³Ù„ÙŠÙ…|Ø±ÙƒÙŠÙƒ","score":0,"summary":"Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø©","issues":[{"type":"Ù„ØºÙˆÙŠ|Ø£Ø³Ù„ÙˆØ¨ÙŠ|Ù…Ù†Ø·Ù‚ÙŠ|Ù†Ø§Ù‚Øµ","text":"ÙˆØµÙ"}],"strengths":["Ù†Ù‚Ø·Ø© Ù‚ÙˆØ©"]}`;

  try {
    const raw=await groq([{role:'user',content:p}],false);
    const result=JSON.parse(raw.replace(/```json|```/g,'').trim());
    renderEval(result,text,res);
  } catch(e) {
    res.innerHTML=`<div style="padding:14px;background:var(--red-dim);border:1px solid rgba(255,77,109,0.25);border-radius:10px;font-size:12px;color:var(--red)">âŒ ${e.message}</div>`;
  } finally {
    btn.disabled=false; btn.textContent='ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙ‚Ø±ÙŠØ±';
  }
}

function renderEval(r, origText, container) {
  const good=r.verdict==='Ø³Ù„ÙŠÙ…', score=r.score||0;
  container.innerHTML='';
  const wrap=document.createElement('div'); wrap.className='eval-block';

  const vc=document.createElement('div'); vc.className=`eval-verdict ${good?'good':'bad'}`;
  vc.innerHTML=`<div><div class="eval-lbl ${good?'good':'bad'}">${good?'âœ… ØªÙ‚Ø±ÙŠØ± Ø³Ù„ÙŠÙ…':'âš ï¸ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©'}</div><div class="eval-sum">${r.summary||''}</div></div><div style="text-align:center"><div class="eval-score ${good?'good':'bad'}" id="escore">0</div><div class="eval-score-label">/ 100</div></div>`;
  wrap.appendChild(vc);
  let s=0;const ti=setInterval(()=>{s=Math.min(s+2,score);const el=document.getElementById('escore');if(el)el.textContent=s;if(s>=score)clearInterval(ti);},18);

  if(r.strengths?.length) {
    const sec=document.createElement('div'); sec.className='eval-sec';
    sec.innerHTML=`<div class="eval-sec-h" style="color:var(--accent)">ğŸ’ª Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</div><div class="eval-sec-b">${r.strengths.map(s=>`<div class="eval-str">${s}</div>`).join('')}</div>`;
    wrap.appendChild(sec);
  }
  if(r.issues?.length) {
    const sec=document.createElement('div'); sec.className='eval-sec';
    sec.innerHTML=`<div class="eval-sec-h" style="color:var(--red)">âš ï¸ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</div><div class="eval-sec-b">${r.issues.map(i=>`<div class="eval-issue"><span class="iss-badge">${i.type}</span><span class="iss-txt">${i.text}</span></div>`).join('')}</div>`;
    wrap.appendChild(sec);
  }
  if(!good) {
    const b=document.createElement('button'); b.className='convert-btn';
    b.textContent='âš–ï¸ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ø±Ø³Ù…ÙŠ Ù„Ù„Ù†ÙŠØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©';
    b.onclick=()=>convertFormal(origText,wrap,b);
    wrap.appendChild(b);
  }
  container.appendChild(wrap);
}

async function convertFormal(text, wrap, triggerBtn) {
  triggerBtn.disabled=true; triggerBtn.textContent='Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
  const today=new Date().toLocaleDateString('ar-SA',{year:'numeric',month:'long',day:'numeric'});
  const p=`Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠ ÙˆØ·Ø¨ÙŠØ¨ Ø´Ø±Ø¹ÙŠ. Ø£Ø¹Ø¯ ØµÙŠØ§ØºØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¥Ø·Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø±Ø³Ù…ÙŠ Ù…ÙˆØ¬Ù‡ Ù„Ù„Ù†ÙŠØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„ØµØ§Ø±Ù… Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯:
1. Ù„Ø§ ØªØ¶Ù Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø£ØµÙ„
2. Ù„Ø§ ØªØ­Ø°Ù Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ±
3. Ø£Ø¹Ø¯ Ø§Ù„ØµÙŠØ§ØºØ© Ø¨Ù„ØºØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø±Ø³Ù…ÙŠØ© ÙÙ‚Ø·
4. Ø£Ø¶Ù Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙƒÙ…Ø±Ø¬Ø¹
5. Ø£Ø¶Ù Ø¥Ù‚Ø±Ø§Ø± Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø±Ø³Ù…ÙŠ ÙÙŠ Ø§Ù„Ø®Ø§ØªÙ…Ø©

Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£ØµÙ„ÙŠ:
---
${text}
---

Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù‡ÙŠÙƒÙ„:

Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…

ØªÙ‚Ø±ÙŠØ± Ø·Ø¨ÙŠ Ø´Ø±Ø¹ÙŠ Ø±Ø³Ù…ÙŠ
=====================
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}
Ù…Ù‚Ø¯Ù… Ø¥Ù„Ù‰: Ø§Ù„Ø³ÙŠØ¯ Ø§Ù„Ù…Ø­ØªØ±Ù… / ÙˆÙƒÙŠÙ„ Ø§Ù„Ù†ÙŠØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø§Ù„Ù…Ø®ØªØµ

ØªÙ…Ù‡ÙŠØ¯ Ù‚Ø§Ù†ÙˆÙ†ÙŠ:
Ø§Ø³ØªÙ†Ø§Ø¯Ø§Ù‹ Ø¥Ù„Ù‰ Ø£Ø­ÙƒØ§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦ÙŠØ© ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©ØŒ ÙŠØªØ¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ù…Ø§ ÙŠÙ„ÙŠ:

[Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¨ØµÙŠØ§ØºØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©]

Ø§Ù„Ø¥Ù‚Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ:
Ø£ÙÙ‚Ø±Ù‘ Ø¨Ø£Ù† Ù…Ø§ ÙˆØ±Ø¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØµØ­ÙŠØ­ ÙˆÙÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ.

Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ Ø§Ù„Ù…Ø®ØªØµ
Ø§Ù„Ø§Ø³Ù…: _______________
Ø§Ù„ØªÙˆÙ‚ÙŠØ¹: _______________
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}`;

  try {
    const rep=await groq([{role:'user',content:p}],false);
    triggerBtn.remove();
    const fc=document.createElement('div'); fc.className='rep-card';
    fc.innerHTML=`<div class="rep-head"><span class="rep-head-title">âš–ï¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø³Ù…ÙŠ â€” Ø§Ù„Ù†ÙŠØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</span><button class="copy-btn" onclick="copyTxt(this,\`${escAttr(rep)}\`)">ğŸ“‹ Ù†Ø³Ø®</button></div><div class="rep-body">${escHtml(rep)}</div>`;
    wrap.appendChild(fc);
    const eb=document.createElement('button'); eb.className='export-btn'; eb.textContent='ğŸ“„ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø³Ù…ÙŠ';
    eb.onclick=()=>dlTxt(rep,'forensic-official'); wrap.appendChild(eb);
  } catch(e) {
    triggerBtn.disabled=false; triggerBtn.textContent='âš–ï¸ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØªÙ‚Ø±ÙŠØ± Ø±Ø³Ù…ÙŠ Ù„Ù„Ù†ÙŠØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©';
    alert('âŒ '+e.message);
  }
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('overlay').classList.toggle('show'); }
function closeSidebar()  { document.getElementById('sidebar').classList.remove('open'); document.getElementById('overlay').classList.remove('show'); }

function copyTxt(btn,text) { navigator.clipboard.writeText(text).then(()=>{const o=btn.textContent;btn.textContent='âœ… ØªÙ…';setTimeout(()=>btn.textContent=o,2000)}); }
function dlTxt(txt,name)   { const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([txt],{type:'text/plain;charset=utf-8'}));a.download=`${name}-${Date.now()}.txt`;a.click(); }
function escHtml(s)  { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escAttr(s)  { return s.replace(/`/g,"'").replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/"/g,'&quot;'); }
</script>
</body>
</html>
